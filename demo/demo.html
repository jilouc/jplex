<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content='text/html; charset=UTF-8'/>
    <link rel="stylesheet" href="./global/syntax_highlighter.css" type="text/css"/>
    <link rel="stylesheet" href="../src/jplex/components/menubar/assets/menubar.css" type="text/css"/>
    <link rel="stylesheet" href="../src/jplex/components/frame/assets/frame.css" type="text/css"/>
    <link rel="stylesheet" href="../src/jplex/components/tabs/assets/tabs.css" type="text/css"/>
    <link rel="stylesheet" href="./global/styles.css" type="text/css"/>
    <script src="../src/jPlex.js" type="text/javascript" charset="utf-8">
    </script>
    <script src="./global/syntax_highlighter.js" type="text/javascript" charset="utf-8">
    </script>
</head>
<body>

<script type="text/javascript">
    <!--
    function viewSource(file) {
        var res;
        new Ajax.Request("./global/code/"+file+".js.html", {
            asynchronous:false,
            onComplete: function(transport) { res = transport.responseText; }
        });
        var code = $C('code-'+file);
        if(code) {
            code.show();
            code.toFront.bind(code).defer();
            return $C('code-'+file);
        }
        code = new Frame("code-"+file, {draggable:true, title:"Code snippet"});
        code.setBody(res);
        code.component.addClassName('code-window');
        CodeHighlighter.init();
        var w = g.add(code);
        w.toFront.bind(w).defer();

        return w;

    }


    jPlex.include("jplex.components.MenuBar");
    jPlex.include('jplex.components.Frame');
    jPlex.include('jplex.components.frame.Modal');
    jPlex.include('jplex.components.frame.WindowsGroup');
    jPlex.include('jplex.components.Tabs');
    jPlex.include('jplex.components.MouseOverImage');

    var g = new WindowsGroup('test');
    var first = new Frame('what', {
        close: Frame.CLOSE_CUSTOM,
        ajax: "./global/home.html",
        draggable: true,
        title: "Welcome!",
        footer: true
    });
    first.setFooter("<span id='code-snippet'>Click to get some information about the code used in the current page</span> "+
                    "<img src='./global/img/131.png' align='absmiddle' alt='' /> " +
                    "<input type='button' id='code' value='View code snippets' />");
    $('code').observe('click', viewSource.curry("home"));
    g.add(first);

    first.setTitle("Welcome!");


    Effect.Desktop = Class.create(Effect.Base, {
        initialize: function(winGroup) {
            this.group = $C(winGroup);
            this._implode = this.implode.bind(this);

            var dirs = ["right", "bottom", "left", "top"];

            this.group.windows.each(function(s,i) {
                this.explode(s, dirs[i%4]);

            }.bind(this));
        },

        implode: function() {

            this.group.windows.each(function(s, i) {
                new Effect.Move(s.component, {
                    x: s._oldXY.get("x"),
                    y: s._oldXY.get("y"),
                    mode: "absolute"
                });
                s.component.stopObserving("click", this._implode); 
            }.bind(this));
        },

        explode: function(win, dir) {
            var vpDim = document.viewport.getDimensions();
            var dim = win.component.getDimensions();
            var pos = win.component.cumulativeOffset();
            win._oldXY = $H();
            win._oldXY.set("x", pos.left);
            win._oldXY.set("y", pos.top);

            var x,y;

            if(dir == 'right') {
                x = vpDim.width - 100;
                y = pos.top;
            } else if(dir == 'left') {
                x = - dim.width + 100;
                y = pos.top;
            } else if(dir == 'top') {
                x = pos.left;
                y = vpDim - 50;
            } else {
                x = pos.left;
                y = - dim.height + 50;
            }

            new Effect.Move(win.component, {
                x: x,
                y: y,
                mode: 'absolute'
            });

            win.component.observe("click", this._implode);
        },

        update: Prototype.emptyFunction
    })

    var e = null;
    document.bindKey(Event.Key.F11, function() {
        if(!e) {
            e = new Effect.Desktop("test");
        } else {
            e.implode();
            e = null;
        }
    },{preventDefault:true, ctrl:true});

    var myData = [{
        name: "File",
        items: [{
            name: "New...",
            icon: "img/001.png",
            items: [{
                name: "Frame...",
                icon: "./global/img/sheet2.png",
                items: [{
                    name: "Modal",
                    click: Prototype.emptyFunction,
                    keySC: {
                        key: Event.Key.M,
                        ctrl: true,
                        text: "Ctrl + M"
                    }
                }, {
                    name: "Dialog",
                    click: Prototype.emptyFunction,
                    keySC: {
                        key: Event.Key.D,
                        ctrl: true,
                        text: "Ctrl + D"
                    }
                }]
            }, {
                name: ""
            }, ]
        }, {
            name: "Download jPlex",
            items: [{
                name: "Pangolin Compressed"
            }, {name: "Pangolin Source"}]
        }, {
            name: "Close",
            keySC: {
                key: Event.Key.W,
                ctrl: true,
                text: "Ctrl + W"
            }
        }]
    }, {
        name: "jPlex",
        items:[{
            name:"Homepage",
            icon:"img/031.png",
            link:"http://www.google.fr"
        }, {
            name:"Documentation"
        }, {
            name:"Example"
        }]
    },
        {
            name: "Help",
            items:[{
                name:"What do I see ?",
                icon: "./global/img/misc.png"
            }, {
                name:"About",

                icon: "./global/img/help.png",
                click: function() {
                    if (!(about = $C("about"))) {
                        var about = new Modal('about', {
                            draggable: true,
                            ajax: "./global/about.html",
                            overlayFade: 0.5
                        });

                        about.setTitle("About");
                    }
                    about.show();

                }
            }]
        }];

    /**
     * 
     */
    first.setEvent('onAjaxRequestCompleteEvent', function() {
        Event.onElementReady('menu', function() {
            new MenuBar("menu", {data:myData});
        });

        Event.onElementReady('tab-why-jplex', function() {
            var myTabsData = [
                {title: 'What is jPlex ?', content:'tab-what-is-jplex'},
                {title: 'Why jPlex ?', content:'tab-why-jplex'}];
            var tabs = new Tabs("home-tabs", {data: myTabsData});
            tabs.setEvent("onSwitchEvent", first.makeCentered.bind(first));

        });
        
        new MouseOverImage('code-snippet', {img:'./global/img/lifebuoy.png', position:'middle'});
    });

        //-->
</script>
</body>
</html>